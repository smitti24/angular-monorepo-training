# Lesson 3.3: Enforcing Boundaries with Tags

## Theory

Without enforcement, your library architecture is just a suggestion. NX's `@nx/enforce-module-boundaries` ESLint rule validates imports at lint time based on **tags** assigned to each project.

### Tag Strategy (Two Dimensions)

**Type** (architectural layer):
- `type:app` → can depend on `type:feature` only
- `type:feature` → can depend on `type:ui`, `type:data-access`, `type:util`
- `type:ui` → can depend on `type:data-access`, `type:util`
- `type:data-access` → can depend on `type:util`
- `type:util` → depends on nothing (leaf node)

**Scope** (business domain):
- `scope:tasks` → can depend on `scope:tasks` or `scope:shared`
- `scope:shared` → can depend on `scope:shared` only

### Dependency Flow

```
app → feature → ui → data-access → util
                   → data-access
```

---

## Hands-On

### Step 1: Add tags to every `project.json`

| Project | Tags |
|---------|------|
| `apps/shell` | `["type:app", "scope:shell"]` |
| `libs/tasks/feature` | `["type:feature", "scope:tasks"]` |
| `libs/tasks/ui` | `["type:ui", "scope:tasks"]` |
| `libs/tasks/data-access` | `["type:data-access", "scope:tasks"]` |
| `libs/shared/ui` | `["type:ui", "scope:shared"]` |
| `libs/shared/util` | `["type:util", "scope:shared"]` |

### Step 2: Configure boundary rules in root `eslint.config.mjs`

Replace the `depConstraints` array:

```javascript
depConstraints: [
  { sourceTag: 'type:app', onlyDependOnLibsWithTags: ['type:feature'] },
  { sourceTag: 'type:feature', onlyDependOnLibsWithTags: ['type:ui', 'type:data-access', 'type:util'] },
  { sourceTag: 'type:ui', onlyDependOnLibsWithTags: ['type:data-access', 'type:util'] },
  { sourceTag: 'type:data-access', onlyDependOnLibsWithTags: ['type:util'] },
  { sourceTag: 'type:util', onlyDependOnLibsWithTags: [] },
  { sourceTag: 'scope:tasks', onlyDependOnLibsWithTags: ['scope:tasks', 'scope:shared'] },
  { sourceTag: 'scope:shared', onlyDependOnLibsWithTags: ['scope:shared'] },
]
```

**Note:** The property is `onlyDependOnLibsWithTags` (no "s" after "Depend"). Using `onlyDependsOnLibsWithTags` causes ESLint config errors.

### Step 3: Verify

```bash
npx nx run-many -t lint    # All projects should pass
```

### Step 4: Test a violation

Add a bad import in a UI component:
```typescript
import { TaskTracker } from '@nx-mf-training/feature';  // UI → feature = WRONG
```

Run `npx nx lint tasks-ui` — expect errors:
- Circular dependency detected
- `type:ui` cannot depend on `type:feature`

Remove the bad import after testing.

---

## Key Takeaways

1. **Tags are two-dimensional**: type (layer) + scope (domain) — both constraints apply simultaneously
2. **`@nx/enforce-module-boundaries`** runs at lint time — catches violations in IDE and CI
3. **VS Code ESLint integration** gives instant feedback (red squiggly lines, auto-removal on save)
4. **Circular dependencies** are automatically detected and blocked
5. In CI, `nx run-many -t lint` blocks PRs with boundary violations
6. Tags scale: when you add a `users/` domain, just add `scope:users` and the same type rules apply
