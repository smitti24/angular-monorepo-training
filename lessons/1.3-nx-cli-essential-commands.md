# Lesson 1.3: NX CLI & Essential Commands

## CLI Structure

Every NX command follows this pattern:

```
nx <command> [project] [options]
```

Commands fall into three categories:

| Category | Purpose | Examples |
|----------|---------|---------|
| **Task runners** | Execute targets on projects | `run`, `serve`, `build`, `test`, `lint` |
| **Code generation** | Scaffold code | `generate` |
| **Workspace info** | Inspect & debug | `graph`, `show`, `list`, `report` |

---

## Quick Reference

### Running Targets

```bash
# These are equivalent
npx nx test shell              # shorthand
npx nx run shell:test          # explicit (project:target)
npx nx run shell:build:production  # with configuration (project:target:config)

# Core targets
npx nx serve shell             # Dev server (http://localhost:4200)
npx nx build shell             # Production build → dist/apps/shell/
npx nx test shell              # Unit tests (Vitest)
npx nx lint shell              # ESLint
```

### Running Across Multiple Projects

```bash
npx nx run-many -t test        # Run test on ALL projects that have it
npx nx run-many -t lint        # Lint everything
npx nx run-many -t build       # Build everything
npx nx run-many -t test -t lint  # Multiple targets at once
```

### Workspace Info

```bash
npx nx show projects           # List all projects
npx nx show project shell      # Show resolved config for a project
npx nx graph                   # Interactive dependency graph (opens browser)
npx nx list                    # List installed plugins
npx nx list @nx/angular        # Show generators & executors for a plugin
npx nx report                  # Show NX plugin versions (debug version mismatches)
```

### Code Generation

```bash
npx nx generate @nx/angular:component --name=header --project=shell
npx nx generate @nx/angular:component --name=header --project=shell --dry-run  # Preview only
```

Always use `--dry-run` first when you're unsure what files will be created.

### Maintenance

```bash
npx nx reset                   # Clear NX cache
npx nx migrate nx@<version>    # Upgrade NX (aligns all @nx/* packages)
npm install                    # After migrate updates package.json
npx nx migrate --run-migrations  # Run code migrations (if migrations.json created)
```

---

## NX Caching

When you run a target, NX hashes the inputs (source files, config, dependencies). On subsequent runs, if nothing changed, NX replays the cached output instantly.

```bash
npx nx test shell     # First run — actually executes Vitest
npx nx test shell     # Second run — "cache hit", instant replay
```

Cache is per-target, per-project. Enabled via `"cache": true` in `targetDefaults` (nx.json).

---

## Version Management

All `@nx/*` packages must be on the same version. Never manually bump versions in `package.json`.

```bash
npx nx migrate nx@22.5.0       # Updates package.json + creates migrations.json
npm install                     # Install updated packages
npx nx migrate --run-migrations # Run any code migrations
rm migrations.json              # Clean up
```

---

## Key Takeaways

1. `nx <target> <project>` is the pattern you'll use 90% of the time
2. `run-many -t <target>` runs across all projects — essential for CI
3. `--dry-run` on generators previews changes before writing files
4. NX **caches** target results — second run is instant if inputs haven't changed
5. Always use `nx migrate` to upgrade — never manually edit NX versions
6. `nx graph` becomes your best friend as the monorepo grows
7. `nx show project <name>` is the debugger for project config issues
